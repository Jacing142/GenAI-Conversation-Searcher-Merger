<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>GenAI Conversation Searcher & Merger</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Vendor CSS (pinned) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.12.0/toastify.min.css" />

  <!-- Inline favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text y='14' font-size='14'>ðŸ¤–</text></svg>">

  <!-- App CSS -->
  <link rel="stylesheet" href="./style.css"/>
  <link rel="stylesheet" href="./dashboard.css"/>

  <script type="text/javascript">
  (function (f, b) { if (!b.__SV) { var e, g, i, h; window.mixpanel = b; b._i = []; b.init = function (e, f, c) { function g(a, d) { var b = d.split("."); 2 == b.length && ((a = a[b[0]]), (d = b[1])); a[d] = function () { a.push([d].concat(Array.prototype.slice.call(arguments, 0))); }; } var a = b; "undefined" !== typeof c ? (a = b[c] = []) : (c = "mixpanel"); a.people = a.people || []; a.toString = function (a) { var d = "mixpanel"; "mixpanel" !== c && (d += "." + c); a || (d += " (stub)"); return d; }; a.people.toString = function () { return a.toString(1) + ".people (stub)"; }; i = "disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split( " "); for (h = 0; h < i.length; h++) g(a, i[h]); var j = "set set_once union unset remove delete".split(" "); a.get_group = function () { function b(c) { d[c] = function () { call2_args = arguments; call2 = [c].concat(Array.prototype.slice.call(call2_args, 0)); a.push([e, call2]); }; } for ( var d = {}, e = ["get_group"].concat( Array.prototype.slice.call(arguments, 0)), c = 0; c < j.length; c++) b(j[c]); return d; }; b._i.push([e, f, c]); }; b.__SV = 1.2; e = f.createElement("script"); e.type = "text/javascript"; e.async = !0; e.src = "undefined" !== typeof MIXPANEL_CUSTOM_LIB_URL ? MIXPANEL_CUSTOM_LIB_URL : "file:" === f.location.protocol && "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//) ? "https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js" : "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js"; g = f.getElementsByTagName("script")[0]; g.parentNode.insertBefore(e, g); } })(document, window.mixpanel || []);

  // Initialize with your project token
  mixpanel.init("cc23d9486495b370a47e12a1de79c6d2", {
    debug: true,
    track_pageview: true,
    persistence: "localStorage"
  });
  </script>
  
  <style>
    /* Search-specific styles */
    #search-section { margin-top: 1rem; }
    .search-result {
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 1rem;
      margin: 0.5rem 0;
      transition: background 0.2s ease;
    }
    .search-result:hover { background: #f8fafc; }
    .search-result mark {
      background: #fef3c7;
      padding: 2px 4px;
      border-radius: 2px;
      font-weight: 500;
    }
    #searchInput {
      flex: 1;
      padding: 0.6rem;
      border: 1px solid #e2e8f0;
      border-radius: 0.5rem;
      font-size: 14px;
    }
    #searchInput:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    #dateFilter {
      padding: 0.6rem;
      border: 1px solid #e2e8f0;
      border-radius: 0.5rem;
      font-size: 14px;
      background: white;
      cursor: pointer;
    }
    #results-list {
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #e2e8f0;
      border-radius: 0.5rem;
      padding: 1rem;
      background: #fafafa;
    }
    #result-count { font-weight: 600; color: #475569; }
  </style>
</head>
<body>

  <header>
    <h1>GenAI Conversation Explorer</h1>
    <p class="subheader">Merge, Filter, Export GPT & Claude Conversations</p>
  </header>

  <fieldset>
    <legend>1. Upload</legend>

    <div class="row" style="justify-content: space-between; align-items: flex-start;">
      <div style="flex: 1; max-width: 600px;">
        <!-- Hidden file input -->
        <input
          type="file"
          id="fileInput"
          accept=".zip,.json"
          multiple
          style="display:none"
          title="Upload a conversations export (ZIP or JSON)"
          aria-label="Upload conversations file"
        />
        <label for="fileInput" id="fileInputLabel" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">
          Upload conversations file
        </label>

        <!-- Upload button -->
        <button id="uploadBtn">Upload Chat Exports</button>

        <!-- Drag & drop zone -->
        <div id="dropZone" aria-label="Drag and drop files here">
          <div>
            <strong>Drag & drop ChatGPT/Claude ZIP or JSON files here</strong><br>
            <small style="color: #667085;">Supports .zip and .json files up to 100MB</small>
          </div>
        </div>

        <!-- File chips -->
        <div id="file-chips" aria-live="polite"></div>

        <!-- Privacy note -->
        <div id="privacy-note" style="margin-top: 24px;">
          <strong>Privacy:</strong> All processing happens <em>locally in your browser</em>. No files or data are uploaded anywhere.
        </div>
      </div>

      <!-- Reserved space for future onboarding video -->
      <div style="flex: 0 0 300px; margin-left: 32px;">
        <div style="background: #f8fafc; border: 1px dashed #e5e7eb; border-radius: 8px; padding: 40px 20px; text-align: center; color: #667085;">
          <p style="margin: 0; font-size: 14px;">Onboarding video<br>coming soon</p>
        </div>
      </div>
    </div>
  </fieldset>

  <fieldset>
    <legend>2. Analytics</legend>

    <!-- Extract button -->
    <div class="row" style="margin-bottom: 1rem;">
      <button id="extractBtn" disabled>Extract</button>
    </div>

    <div id="progress-wrapper" style="display:none;">
      <span id="status"></span>
      <progress id="progressBar" value="0" max="100"></progress>
    </div>

    <!-- Hidden projects UI -->
    <div id="project-list-container" style="display:none;">
      <h4>Top Projects</h4>
      <div id="project-list"></div>
    </div>
  </fieldset>

  <!-- Search Section -->
  <fieldset id="search-section" style="display:none;">
    <legend>3. Search & Export</legend>
    
    <div class="row" style="margin-bottom: 1rem;">
      <input type="text" id="searchInput" placeholder="Search conversations...">
      <select id="dateFilter">
        <option value="all">All Time</option>
        <option value="30">Last 30 Days</option>
        <option value="90">Last 90 Days</option>
        <option value="365">Last Year</option>
      </select>
      <button id="searchBtn">Search</button>
    </div>

    <!-- Active filter chips -->
    <div id="active-filters" class="chips"></div>
    
    <div id="search-results" style="display:none;">
      <div class="row" style="justify-content: space-between; align-items:center; margin-bottom: 1rem;">
        <span id="result-count">0 results</span>
        <div class="row" style="gap: 8px;">
          <button id="selectAllBtn" class="btn-secondary">Select All</button>
          <button id="clearBtn" class="btn-secondary">Clear</button>
          <button id="exportJsonBtn" class="btn-secondary" disabled title="Export selected conversations as JSON">Export JSON</button>
          <button id="exportHtmlBtn" class="btn-secondary" disabled title="Export selected conversations as HTML">Export HTML</button>
          <button id="exportCsvBtn" class="btn-secondary" disabled title="Export selected conversations as CSV">Export CSV</button>
        </div>
      </div>
      <div id="results-list"><!-- Results inserted here --></div>
    </div>
  </fieldset>

  <div id="spotlight-container" class="container" style="display:none;">
    <h2 id="spotlight-title"></h2>
    <div id="facts-bar"></div>
    <div id="chart-wrap">
      <div id="chart-title"></div>
      <canvas id="chart-canvas"></canvas>
    </div>
  </div>

  <!-- Conversation Modal -->
  <div id="conversation-modal" aria-hidden="true" style="display: none;">
    <div class="modal-backdrop"></div>
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="modal-header">
        <h3 id="modal-title">Conversation</h3>
        <button id="modal-close" aria-label="Close">âœ–</button>
      </div>
      <div class="modal-body" id="modal-body">
        <!-- Full conversation content rendered here -->
      </div>
    </div>
  </div>

  <!-- Vendor JS (pinned, non-module) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.2/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.12.0/toastify.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Entry module -->
  <script type="module" src="./app.js"></script>
</body>
</html>